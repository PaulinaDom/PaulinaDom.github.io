<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Health Insurance SQL Analysis — Paulina Dominikowska</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg:#0e1a14; --surface:#14231a; --surface2:#1b2e22;
      --cream:#f5f0e8; --cream-dim:#b8b0a0;
      --green:#3d7a52; --green-light:#5aad74; --accent:#c8a84b;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:var(--bg); color:var(--cream); font-family:'DM Sans',sans-serif; font-weight:300; line-height:1.7; }
    nav { padding:1.5rem 3rem; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,0.06); position:sticky; top:0; background:rgba(14,26,20,0.95); backdrop-filter:blur(10px); z-index:100; }
    .nav-back { font-family:'DM Mono',monospace; font-size:0.75rem; color:var(--green-light); text-decoration:none; letter-spacing:0.1em; transition:opacity 0.2s; }
    .nav-back:hover { opacity:0.7; }
    .nav-title { font-family:'DM Mono',monospace; font-size:0.7rem; color:var(--cream-dim); letter-spacing:0.15em; text-transform:uppercase; }
    .nav-ext { font-family:'DM Mono',monospace; font-size:0.75rem; color:var(--green-light); text-decoration:none; }
    .hero { padding:5rem 3rem 3rem; max-width:900px; margin:0 auto; }
    .hero-label { font-family:'DM Mono',monospace; font-size:0.7rem; color:var(--green-light); letter-spacing:0.2em; text-transform:uppercase; margin-bottom:1.5rem; }
    h1 { font-family:'Cormorant Garamond',serif; font-size:clamp(2.2rem,5vw,3.5rem); line-height:1.1; margin-bottom:1.5rem; }
    h1 em { font-style:italic; color:var(--accent); }
    .meta-row { display:flex; gap:1rem; flex-wrap:wrap; margin-bottom:2rem; }
    .meta-tag { font-family:'DM Mono',monospace; font-size:0.68rem; padding:0.3rem 0.75rem; border:1px solid var(--green); color:var(--green-light); letter-spacing:0.1em; }
    .intro { font-size:1rem; color:var(--cream-dim); max-width:640px; line-height:1.85; }
    .divider { max-width:900px; margin:2rem auto; height:1px; background:rgba(255,255,255,0.07); }
    .section { max-width:900px; margin:0 auto; padding:2rem 3rem; }
    .section-label { font-family:'DM Mono',monospace; font-size:0.65rem; color:var(--green-light); letter-spacing:0.2em; text-transform:uppercase; margin-bottom:1rem; }
    h2 { font-family:'Cormorant Garamond',serif; font-size:1.8rem; margin-bottom:1.2rem; }
    h3 { font-family:'DM Mono',monospace; font-size:0.75rem; letter-spacing:0.12em; color:var(--cream); text-transform:uppercase; margin:2rem 0 0.8rem; }
    p { color:var(--cream-dim); font-size:0.97rem; margin-bottom:1rem; }
    .analysis-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:1px; background:rgba(255,255,255,0.06); margin:2rem 0; }
    .analysis-card { background:var(--bg); padding:1.8rem; }
    .analysis-num { font-family:'Cormorant Garamond',serif; font-size:2rem; color:var(--accent); display:block; margin-bottom:0.5rem; }
    .analysis-title { font-family:'DM Mono',monospace; font-size:0.7rem; color:var(--cream); letter-spacing:0.08em; margin-bottom:0.5rem; }
    .analysis-text { font-size:0.83rem; color:var(--cream-dim); line-height:1.6; }
    .dax-block { margin:1.5rem 0; }
    .dax-header { background:var(--surface2); padding:0.8rem 1.5rem; border:1px solid rgba(255,255,255,0.08); border-bottom:none; display:flex; justify-content:space-between; align-items:center; }
    .dax-title { font-family:'DM Mono',monospace; font-size:0.7rem; color:var(--green-light); letter-spacing:0.1em; }
    .dax-lang { font-family:'DM Mono',monospace; font-size:0.65rem; color:rgba(255,255,255,0.3); }
    pre { background:#0a1410; border:1px solid rgba(255,255,255,0.08); padding:1.5rem; overflow-x:auto; font-family:'DM Mono',monospace; font-size:0.79rem; line-height:1.75; color:var(--cream-dim); }
    .kw { color:#7eb8f7; }
    .fn { color:var(--green-light); }
    .cm { color:rgba(255,255,255,0.28); font-style:italic; }
    .st { color:var(--accent); }
    .nu { color:#e07840; }
    .skills-box { background:var(--surface); border:1px solid rgba(255,255,255,0.07); padding:2rem; margin:2rem 0; }
    .skills-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:0.75rem; margin-top:1rem; }
    .skill-item { display:flex; align-items:center; gap:0.6rem; font-family:'DM Mono',monospace; font-size:0.72rem; color:var(--cream-dim); }
    .skill-dot { width:5px; height:5px; background:var(--green-light); border-radius:50%; flex-shrink:0; }
    .cta-section { max-width:900px; margin:2rem auto 5rem; padding:0 3rem; display:flex; gap:1rem; flex-wrap:wrap; }
    .btn-primary { font-family:'DM Mono',monospace; font-size:0.75rem; padding:0.85rem 2rem; background:var(--green); color:var(--cream); text-decoration:none; letter-spacing:0.12em; text-transform:uppercase; transition:background 0.2s; }
    .btn-primary:hover { background:var(--green-light); }
    .btn-outline { font-family:'DM Mono',monospace; font-size:0.75rem; padding:0.85rem 2rem; border:1px solid var(--green); color:var(--green-light); text-decoration:none; letter-spacing:0.12em; text-transform:uppercase; transition:all 0.2s; }
    .btn-outline:hover { background:rgba(61,122,82,0.15); }
    footer { border-top:1px solid rgba(255,255,255,0.06); padding:2rem 3rem; text-align:center; font-family:'DM Mono',monospace; font-size:0.65rem; color:rgba(255,255,255,0.2); letter-spacing:0.1em; }
    @media(max-width:640px) { nav,.hero,.section,.cta-section { padding-left:1.5rem; padding-right:1.5rem; } }
  </style>
</head>
<body>

<nav>
  <a href="index.html" class="nav-back">← Back to Portfolio</a>
  <span class="nav-title">Project 03 — SQL</span>
  <a href="https://github.com/PaulinaDom/data-analyst-portfolio/tree/main/Analyzing-insurance-data/SQL" target="_blank" class="nav-ext">GitHub ↗</a>
</nav>

<div class="hero">
  <div class="hero-label">SQL Analysis · Project 03</div>
  <h1>Health Insurance Data<br><em>Analysis Using SQL</em></h1>
  <div class="meta-row">
    <span class="meta-tag">SQL</span>
    <span class="meta-tag">CTEs</span>
    <span class="meta-tag">Window Functions</span>
    <span class="meta-tag">Temp Tables</span>
    <span class="meta-tag">Conditional Aggregation</span>
  </div>
  <p class="intro">A deep SQL exploration of 1,338 health insurance records — uncovering how BMI, age, smoking status, and family size drive insurance charges, using a wide range of advanced SQL techniques from CTEs to window-based ranking.</p>
</div>

<div class="divider"></div>

<div class="section">
  <div class="section-label">What Was Analyzed</div>
  <h2>9 lines of inquiry</h2>
  <p>The analysis moves from general statistics through demographic breakdowns to high-cost outlier identification, building progressively in complexity.</p>

  <div class="analysis-grid">
    <div class="analysis-card">
      <span class="analysis-num">01</span>
      <div class="analysis-title">General Statistics</div>
      <div class="analysis-text">Average BMI, age, charges, children per individual. Percentage of smokers in the dataset as a baseline.</div>
    </div>
    <div class="analysis-card">
      <span class="analysis-num">02</span>
      <div class="analysis-title">Age Group Analysis</div>
      <div class="analysis-text">Temporary table for 5-year age bins. Aggregated BMI, total and average insurance costs per age group.</div>
    </div>
    <div class="analysis-card">
      <span class="analysis-num">03</span>
      <div class="analysis-title">BMI Classification</div>
      <div class="analysis-text">Individuals categorized as overweight, normal weight, or underweight. Charges compared across BMI groups with % share of total costs.</div>
    </div>
    <div class="analysis-card">
      <span class="analysis-num">04</span>
      <div class="analysis-title">High-Cost Individuals</div>
      <div class="analysis-text">CTE filtering individuals above the dataset's average charge. Profile: average age, BMI, children count, and smoking rate.</div>
    </div>
    <div class="analysis-card">
      <span class="analysis-num">05</span>
      <div class="analysis-title">Children &amp; Smoking</div>
      <div class="analysis-text">Impact of family size on total and average charges. Smoking rates across different numbers of dependents.</div>
    </div>
    <div class="analysis-card">
      <span class="analysis-num">06</span>
      <div class="analysis-title">Top 150 Charges</div>
      <div class="analysis-text">Extracted the 150 highest-charge records and profiled them: age, BMI, children, smoking %, gender split.</div>
    </div>
    <div class="analysis-card">
      <span class="analysis-num">07</span>
      <div class="analysis-title">Smoker vs Non-Smoker</div>
      <div class="analysis-text">Overweight % comparison between smokers and non-smokers. How many in each group exceed the average charge threshold.</div>
    </div>
    <div class="analysis-card">
      <span class="analysis-num">08</span>
      <div class="analysis-title">Rankings by Group</div>
      <div class="analysis-text">RANK() window function to rank individuals by charge within smoker vs non-smoker groups. Top 20 per category extracted.</div>
    </div>
    <div class="analysis-card">
      <span class="analysis-num">09</span>
      <div class="analysis-title">High-Risk Individuals</div>
      <div class="analysis-text">Defined as: smoker AND BMI &gt; 30. Sorted by charges descending — the dataset's highest-risk, highest-cost cohort.</div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-label">SQL Techniques</div>
  <h2>Selected queries</h2>

  <h3>CTE — High-cost individual profile</h3>
  <div class="dax-block">
    <div class="dax-header"><span class="dax-title">Filter above-average charges, then profile the group</span><span class="dax-lang">SQL</span></div>
    <pre><span class="cm">-- CTE identifies individuals with charges above dataset average,
-- then the outer query profiles that high-cost group</span>
<span class="kw">WITH</span> high_cost <span class="kw">AS</span> (
    <span class="kw">SELECT</span> *
    <span class="kw">FROM</span> insurance
    <span class="kw">WHERE</span> charges > (<span class="kw">SELECT</span> <span class="fn">AVG</span>(charges) <span class="kw">FROM</span> insurance)
)
<span class="kw">SELECT</span>
    <span class="fn">AVG</span>(age)                                          <span class="kw">AS</span> avg_age,
    <span class="fn">AVG</span>(bmi)                                          <span class="kw">AS</span> avg_bmi,
    <span class="fn">AVG</span>(children)                                     <span class="kw">AS</span> avg_children,
    <span class="fn">COUNT</span>(<span class="kw">CASE WHEN</span> smoker = <span class="st">'yes'</span> <span class="kw">THEN</span> <span class="nu">1</span> <span class="kw">END</span>) * <span class="nu">100.0</span>
        / <span class="fn">COUNT</span>(*)                                    <span class="kw">AS</span> pct_smokers
<span class="kw">FROM</span> high_cost;</pre>
  </div>

  <h3>Window Function — ranking within smoker groups</h3>
  <div class="dax-block">
    <div class="dax-header"><span class="dax-title">RANK() partitioned by smoker status</span><span class="dax-lang">SQL</span></div>
    <pre><span class="cm">-- Ranks individuals by charges separately within
-- smoker and non-smoker populations</span>
<span class="kw">WITH</span> ranked <span class="kw">AS</span> (
    <span class="kw">SELECT</span>
        age, bmi, smoker, charges,
        <span class="fn">RANK</span>() <span class="kw">OVER</span> (
            <span class="kw">PARTITION BY</span> smoker
            <span class="kw">ORDER BY</span> charges <span class="kw">DESC</span>
        ) <span class="kw">AS</span> charge_rank
    <span class="kw">FROM</span> insurance
)
<span class="kw">SELECT</span> *
<span class="kw">FROM</span> ranked
<span class="kw">WHERE</span> charge_rank <= <span class="nu">20</span>
<span class="kw">ORDER BY</span> smoker, charge_rank;</pre>
  </div>

  <h3>Temp Table — dynamic age binning</h3>
  <div class="dax-block">
    <div class="dax-header"><span class="dax-title">Temporary table for 5-year age group bins</span><span class="dax-lang">SQL</span></div>
    <pre><span class="cm">-- Creates age group labels, then joins to aggregate
-- BMI and insurance costs per group</span>
<span class="kw">CREATE TEMPORARY TABLE</span> age_bins <span class="kw">AS</span>
<span class="kw">SELECT</span> *,
    <span class="kw">CASE</span>
        <span class="kw">WHEN</span> age <span class="kw">BETWEEN</span> <span class="nu">18</span> <span class="kw">AND</span> <span class="nu">24</span> <span class="kw">THEN</span> <span class="st">'18-24'</span>
        <span class="kw">WHEN</span> age <span class="kw">BETWEEN</span> <span class="nu">25</span> <span class="kw">AND</span> <span class="nu">34</span> <span class="kw">THEN</span> <span class="st">'25-34'</span>
        <span class="kw">WHEN</span> age <span class="kw">BETWEEN</span> <span class="nu">35</span> <span class="kw">AND</span> <span class="nu">44</span> <span class="kw">THEN</span> <span class="st">'35-44'</span>
        <span class="kw">WHEN</span> age <span class="kw">BETWEEN</span> <span class="nu">45</span> <span class="kw">AND</span> <span class="nu">54</span> <span class="kw">THEN</span> <span class="st">'45-54'</span>
        <span class="kw">ELSE</span> <span class="st">'55+'</span>
    <span class="kw">END</span> <span class="kw">AS</span> age_group
<span class="kw">FROM</span> insurance;

<span class="kw">SELECT</span>
    age_group,
    <span class="fn">AVG</span>(bmi)       <span class="kw">AS</span> avg_bmi,
    <span class="fn">SUM</span>(charges)   <span class="kw">AS</span> total_charges,
    <span class="fn">AVG</span>(charges)   <span class="kw">AS</span> avg_charges
<span class="kw">FROM</span> age_bins
<span class="kw">GROUP BY</span> age_group
<span class="kw">ORDER BY</span> age_group;</pre>
  </div>

  <h3>Conditional aggregation — BMI group cost share</h3>
  <div class="dax-block">
    <div class="dax-header"><span class="dax-title">CASE WHEN inside SUM to calculate % of total charges per BMI category</span><span class="dax-lang">SQL</span></div>
    <pre><span class="kw">SELECT</span>
    bmi_category,
    <span class="fn">COUNT</span>(*)                                              <span class="kw">AS</span> count,
    <span class="fn">AVG</span>(charges)                                          <span class="kw">AS</span> avg_charges,
    <span class="fn">SUM</span>(charges) * <span class="nu">100.0</span> / <span class="fn">SUM</span>(<span class="fn">SUM</span>(charges)) <span class="kw">OVER</span> ()   <span class="kw">AS</span> pct_total_charges
<span class="kw">FROM</span> (
    <span class="kw">SELECT</span> charges,
        <span class="kw">CASE</span>
            <span class="kw">WHEN</span> bmi >= <span class="nu">30</span>                  <span class="kw">THEN</span> <span class="st">'Overweight'</span>
            <span class="kw">WHEN</span> bmi <span class="kw">BETWEEN</span> <span class="nu">18.5</span> <span class="kw">AND</span> <span class="nu">29.9</span> <span class="kw">THEN</span> <span class="st">'Normal Weight'</span>
            <span class="kw">ELSE</span>                                     <span class="st">'Underweight'</span>
        <span class="kw">END</span> <span class="kw">AS</span> bmi_category
    <span class="kw">FROM</span> insurance
) sub
<span class="kw">GROUP BY</span> bmi_category;</pre>
  </div>
</div>

<div class="section">
  <div class="skills-box">
    <div class="section-label">SQL Techniques Used</div>
    <div class="skills-grid">
      <div class="skill-item"><span class="skill-dot"></span>AVG, SUM, COUNT, MIN, MAX</div>
      <div class="skill-item"><span class="skill-dot"></span>GROUP BY &amp; ORDER BY</div>
      <div class="skill-item"><span class="skill-dot"></span>CASE WHEN (classification &amp; filtering)</div>
      <div class="skill-item"><span class="skill-dot"></span>Common Table Expressions (CTEs)</div>
      <div class="skill-item"><span class="skill-dot"></span>Subqueries in SELECT, FROM, WHERE</div>
      <div class="skill-item"><span class="skill-dot"></span>Temporary Tables (dynamic binning)</div>
      <div class="skill-item"><span class="skill-dot"></span>RANK() OVER() window function</div>
      <div class="skill-item"><span class="skill-dot"></span>PARTITION BY for group ranking</div>
      <div class="skill-item"><span class="skill-dot"></span>CONCAT() for formatted output</div>
      <div class="skill-item"><span class="skill-dot"></span>Conditional aggregation</div>
    </div>
  </div>
</div>

<div class="cta-section">
  <a href="https://github.com/PaulinaDom/data-analyst-portfolio/tree/main/Analyzing-insurance-data/SQL" target="_blank" class="btn-primary">View Full Code on GitHub ↗</a>
  <a href="project-health-powerbi.html" class="btn-outline">See Power BI Report of Same Data →</a>
</div>

<footer>© 2025 Paulina Dominikowska · Data Analyst Portfolio</footer>
</body>
</html>
